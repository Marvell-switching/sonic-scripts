From 7cae8446b0f1256ca5d781608ccf0d3540497203 Mon Sep 17 00:00:00 2001
From: Yan Markman <ymarkman@marvell.com>
Date: Fri, 31 Oct 2025 13:33:43 +0200
Subject: [PATCH 1/1] move i2c-adapter to i2c-dev using

Signed-off-by: Yan Markman <ymarkman@marvell.com>
---
 db98cx8514-10cc/sonic_platform/eeprom.py   | 8 ++++----
 db98cx8522-10cc/sonic_platform/eeprom.py   | 8 ++++----
 db98cx8540-16cd/sonic_platform/eeprom.py   | 8 ++++----
 db98cx8580-32cd/sonic_platform/eeprom.py   | 8 ++++----
 rd98dx35xx-x86/sonic_platform/eeprom.py    | 4 ++--
 rd98dx35xx/scripts/rd98dx35xx-init.sh      | 4 ++--
 rd98dx35xx/sonic_platform/eeprom.py        | 4 ++--
 rd98dx35xx_cn9131/sonic_platform/eeprom.py | 4 ++--
 rd98dx45xx_cn9131/sonic_platform/eeprom.py | 4 ++--
 9 files changed, 26 insertions(+), 26 deletions(-)

diff --git a/db98cx8514-10cc/sonic_platform/eeprom.py b/db98cx8514-10cc/sonic_platform/eeprom.py
index cbf859f..a5f6448 100644
--- a/db98cx8514-10cc/sonic_platform/eeprom.py
+++ b/db98cx8514-10cc/sonic_platform/eeprom.py
@@ -28,7 +28,7 @@ fan_eeprom_format = [
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -47,15 +47,15 @@ class Eeprom(TlvInfoDecoder):
                 self.index = psu_index
                 self.start_offset = 6
                 self.eeprom_path = self.I2C_DIR \
-                   + "i2c-3{0}/3{0}-0056/eeprom".format(self.index - 1)
+                   + "3{0}-0056/eeprom".format(self.index - 1)
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-0/0-005{}/eeprom".format(2 - self.index)
+                    + "0-005{}/eeprom".format(2 - self.index)
                 self.format = psu_eeprom_format
             else:
                 self.index = fan_index
                 self.start_offset = 13
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-4{0}/4{0}-0050/eeprom".format(self.index - 1)
+                    + "4{0}-0050/eeprom".format(self.index - 1)
                 self.format = fan_eeprom_format
             EepromDecoder.__init__(self, self.eeprom_path, self.format,
                                    self.start_offset, '', True)
diff --git a/db98cx8522-10cc/sonic_platform/eeprom.py b/db98cx8522-10cc/sonic_platform/eeprom.py
index a6f6bea..90e1794 100644
--- a/db98cx8522-10cc/sonic_platform/eeprom.py
+++ b/db98cx8522-10cc/sonic_platform/eeprom.py
@@ -38,7 +38,7 @@ fan_eeprom_format = [
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -57,15 +57,15 @@ class Eeprom(TlvInfoDecoder):
                 self.index = psu_index
                 self.start_offset = 6
                 #self.eeprom_path = self.I2C_DIR \
-                #    + "i2c-3{0}/3{0}-0056/eeprom".format(self.index - 1)
+                #    + "3{0}-0056/eeprom".format(self.index - 1)
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-0/0-005{}/eeprom".format(2 - self.index)
+                    + "0-005{}/eeprom".format(2 - self.index)
                 self.format = psu_eeprom_format
             else:
                 self.index = fan_index
                 self.start_offset = 13
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-4{0}/4{0}-0050/eeprom".format(self.index - 1)
+                    + "4{0}-0050/eeprom".format(self.index - 1)
                 self.format = fan_eeprom_format
             EepromDecoder.__init__(self, self.eeprom_path, self.format,
                                    self.start_offset, '', True)
diff --git a/db98cx8540-16cd/sonic_platform/eeprom.py b/db98cx8540-16cd/sonic_platform/eeprom.py
index a6f6bea..90e1794 100644
--- a/db98cx8540-16cd/sonic_platform/eeprom.py
+++ b/db98cx8540-16cd/sonic_platform/eeprom.py
@@ -38,7 +38,7 @@ fan_eeprom_format = [
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -57,15 +57,15 @@ class Eeprom(TlvInfoDecoder):
                 self.index = psu_index
                 self.start_offset = 6
                 #self.eeprom_path = self.I2C_DIR \
-                #    + "i2c-3{0}/3{0}-0056/eeprom".format(self.index - 1)
+                #    + "3{0}-0056/eeprom".format(self.index - 1)
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-0/0-005{}/eeprom".format(2 - self.index)
+                    + "0-005{}/eeprom".format(2 - self.index)
                 self.format = psu_eeprom_format
             else:
                 self.index = fan_index
                 self.start_offset = 13
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-4{0}/4{0}-0050/eeprom".format(self.index - 1)
+                    + "4{0}-0050/eeprom".format(self.index - 1)
                 self.format = fan_eeprom_format
             EepromDecoder.__init__(self, self.eeprom_path, self.format,
                                    self.start_offset, '', True)
diff --git a/db98cx8580-32cd/sonic_platform/eeprom.py b/db98cx8580-32cd/sonic_platform/eeprom.py
index a6f6bea..90e1794 100644
--- a/db98cx8580-32cd/sonic_platform/eeprom.py
+++ b/db98cx8580-32cd/sonic_platform/eeprom.py
@@ -38,7 +38,7 @@ fan_eeprom_format = [
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -57,15 +57,15 @@ class Eeprom(TlvInfoDecoder):
                 self.index = psu_index
                 self.start_offset = 6
                 #self.eeprom_path = self.I2C_DIR \
-                #    + "i2c-3{0}/3{0}-0056/eeprom".format(self.index - 1)
+                #    + "3{0}-0056/eeprom".format(self.index - 1)
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-0/0-005{}/eeprom".format(2 - self.index)
+                    + "0-005{}/eeprom".format(2 - self.index)
                 self.format = psu_eeprom_format
             else:
                 self.index = fan_index
                 self.start_offset = 13
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-4{0}/4{0}-0050/eeprom".format(self.index - 1)
+                    + "4{0}-0050/eeprom".format(self.index - 1)
                 self.format = fan_eeprom_format
             EepromDecoder.__init__(self, self.eeprom_path, self.format,
                                    self.start_offset, '', True)
diff --git a/rd98dx35xx-x86/sonic_platform/eeprom.py b/rd98dx35xx-x86/sonic_platform/eeprom.py
index 1ebcc29..76afb29 100644
--- a/rd98dx35xx-x86/sonic_platform/eeprom.py
+++ b/rd98dx35xx-x86/sonic_platform/eeprom.py
@@ -38,7 +38,7 @@ fan_eeprom_format = [
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -47,7 +47,7 @@ class Eeprom(TlvInfoDecoder):
 
         if self.is_sys_eeprom:
             self.start_offset = 0
-            self.eeprom_path = self.I2C_DIR + "i2c-0/2-0050/eeprom"
+            self.eeprom_path = self.I2C_DIR + "2-0050/eeprom"
             # System EEPROM is in ONIE TlvInfo EEPROM format
             super(Eeprom, self).__init__(self.eeprom_path,
                                          self.start_offset, '', True)
diff --git a/rd98dx35xx/scripts/rd98dx35xx-init.sh b/rd98dx35xx/scripts/rd98dx35xx-init.sh
index 72287c4..75230fd 100644
--- a/rd98dx35xx/scripts/rd98dx35xx-init.sh
+++ b/rd98dx35xx/scripts/rd98dx35xx-init.sh
@@ -17,8 +17,8 @@ rd98DX35xx_profile
 # Enumerate the SFP eeprom device on each mux channel
 echo optoe2 0x50 > /sys/bus/i2c/devices/i2c-0/new_device
 # Enumerate system eeprom
-echo 24c64 0x52 > /sys/class/i2c-adapter/i2c-0/new_device
+echo 24c64 0x52 > /sys/bus/i2c/devices/i2c-0/new_device
 sleep 2
-chmod 644 /sys/class/i2c-adapter/i2c-0/0-0052/eeprom
+chmod 644 /sys/bus/i2c/devices/i2c-0/0-0052/eeprom
 
 exit 0
diff --git a/rd98dx35xx/sonic_platform/eeprom.py b/rd98dx35xx/sonic_platform/eeprom.py
index f43a84a..3390f16 100644
--- a/rd98dx35xx/sonic_platform/eeprom.py
+++ b/rd98dx35xx/sonic_platform/eeprom.py
@@ -38,7 +38,7 @@ fan_eeprom_format = [
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -47,7 +47,7 @@ class Eeprom(TlvInfoDecoder):
 
         if self.is_sys_eeprom:
             self.start_offset = 0
-            self.eeprom_path = self.I2C_DIR + "i2c-0/0-0052/eeprom"
+            self.eeprom_path = self.I2C_DIR + "0-0052/eeprom"
             # System EEPROM is in ONIE TlvInfo EEPROM format
             super(Eeprom, self).__init__(self.eeprom_path,
                                          self.start_offset, '', True)
diff --git a/rd98dx35xx_cn9131/sonic_platform/eeprom.py b/rd98dx35xx_cn9131/sonic_platform/eeprom.py
index 1096720..e29edf4 100644
--- a/rd98dx35xx_cn9131/sonic_platform/eeprom.py
+++ b/rd98dx35xx_cn9131/sonic_platform/eeprom.py
@@ -20,7 +20,7 @@ except ImportError as e:
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -29,7 +29,7 @@ class Eeprom(TlvInfoDecoder):
 
         if self.is_sys_eeprom:
             self.start_offset = 0
-            self.eeprom_path = self.I2C_DIR + "i2c-0/0-0050/eeprom"
+            self.eeprom_path = self.I2C_DIR + "0-0050/eeprom"
             # System EEPROM is in ONIE TlvInfo EEPROM format
             super(Eeprom, self).__init__(self.eeprom_path,
                                          self.start_offset, '', True)
diff --git a/rd98dx45xx_cn9131/sonic_platform/eeprom.py b/rd98dx45xx_cn9131/sonic_platform/eeprom.py
index 1096720..e29edf4 100644
--- a/rd98dx45xx_cn9131/sonic_platform/eeprom.py
+++ b/rd98dx45xx_cn9131/sonic_platform/eeprom.py
@@ -20,7 +20,7 @@ except ImportError as e:
 
 class Eeprom(TlvInfoDecoder):
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -29,7 +29,7 @@ class Eeprom(TlvInfoDecoder):
 
         if self.is_sys_eeprom:
             self.start_offset = 0
-            self.eeprom_path = self.I2C_DIR + "i2c-0/0-0050/eeprom"
+            self.eeprom_path = self.I2C_DIR + "0-0050/eeprom"
             # System EEPROM is in ONIE TlvInfo EEPROM format
             super(Eeprom, self).__init__(self.eeprom_path,
                                          self.start_offset, '', True)
-- 
2.34.1

