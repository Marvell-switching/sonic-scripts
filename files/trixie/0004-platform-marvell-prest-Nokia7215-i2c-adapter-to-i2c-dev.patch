From 6f4b0264fa9594f073ff509ae0405ec38f82178a Mon Sep 17 00:00:00 2001
From: Yan Markman <ymarkman@marvell.com>
Date: Fri, 31 Oct 2025 13:20:31 +0200
Subject: [PATCH 1/1] platform/marvell-prest: Nokia7215: i2c-adapter to i2c-dev

Signed-off-by: Yan Markman <ymarkman@marvell.com>
---
 .../7215-a1/scripts/nokia-7215-init.sh             |  8 ++++----
 .../7215-a1/sonic_platform/chassis.py              |  4 ++--
 .../7215-a1/sonic_platform/eeprom.py               |  4 ++--
 .../7215-a1/sonic_platform/thermal.py              |  8 ++++----
 .../7215/scripts/nokia-7215init.sh                 | 14 +++++++-------
 .../7215/sonic_platform/chassis.py                 |  4 ++--
 .../7215/sonic_platform/eeprom.py                  |  8 ++++----
 .../7215/sonic_platform/thermal.py                 | 12 ++++++------
 8 files changed, 31 insertions(+), 31 deletions(-)

diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/scripts/nokia-7215-init.sh b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/scripts/nokia-7215-init.sh
index 383d40923..4a0e1f154 100644
--- a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/scripts/nokia-7215-init.sh
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/scripts/nokia-7215-init.sh
@@ -70,12 +70,12 @@ echo tmp75 0x4A > /sys/bus/i2c/devices/i2c-0/new_device
 echo nokia_7215_a1_cpld 0x41 > /sys/bus/i2c/devices/i2c-0/new_device
 
 # Enumerate system eeprom
-echo 24c64 0x53 > /sys/class/i2c-adapter/i2c-0/new_device
+echo 24c64 0x53 > /sys/bus/i2c/devices/i2c-0/new_device
 
-file_exists /sys/class/i2c-adapter/i2c-0/0-0053/eeprom
+file_exists /sys/bus/i2c/devices/i2c-0/0-0053/eeprom
 status=$?
 if [ "$status" == "1" ]; then
-    chmod 644 /sys/class/i2c-adapter/i2c-0/0-0053/eeprom
+    chmod 644 /sys/bus/i2c/devices/i2c-0/0-0053/eeprom
 else
     echo "SYSEEPROM file not foud"
 fi
@@ -99,7 +99,7 @@ for((i=0; i<10; i++));
 # Enumerate the SFP eeprom device on each mux channel
 for mux in ${ismux_bus}
 do
-    echo optoe2 0x50 > /sys/class/i2c-adapter/${mux}/new_device
+    echo optoe2 0x50 > /sys/bus/i2c/devices/${mux}/new_device
 done
 
 # Enable optical SFP Tx
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/chassis.py b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/chassis.py
index 6fdec26ec..870862be0 100644
--- a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/chassis.py
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/chassis.py
@@ -66,8 +66,8 @@ class Chassis(ChassisBase):
 
         # Verify optoe2 driver SFP eeprom devices were enumerated and exist
         # then create the sfp nodes
-        eeprom_path = "/sys/class/i2c-adapter/i2c-{0}/{0}-0050/eeprom"
-        mux_dev = sorted(glob.glob("/sys/class/i2c-adapter/i2c-1/i2c-[0-9]"))
+        eeprom_path = "/sys/bus/i2c/devices/i2c-{0}/{0}-0050/eeprom"
+        mux_dev = sorted(glob.glob("/sys/bus/i2c/devices/i2c-1/i2c-[0-9]"))
         y = 0
         for index in range(self.SFP_PORT_START, self.SFP_PORT_END+1):
             mux_dev_num = mux_dev[y]
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/eeprom.py b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/eeprom.py
index 914c08cfc..8fa883f00 100644
--- a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/eeprom.py
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/eeprom.py
@@ -21,7 +21,7 @@ sonic_logger = logger.Logger('eeprom')
 class Eeprom(TlvInfoDecoder):
     """Nokia platform-specific EEPROM class"""
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -30,7 +30,7 @@ class Eeprom(TlvInfoDecoder):
         
         if self.is_sys_eeprom:
             self.start_offset = 0
-            self.eeprom_path = self.I2C_DIR + "i2c-0/0-0053/eeprom"
+            self.eeprom_path = self.I2C_DIR + "0-0053/eeprom"
             # System EEPROM is in ONIE TlvInfo EEPROM format
             super(Eeprom, self).__init__(self.eeprom_path,
                                          self.start_offset, '', True)
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/thermal.py b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/thermal.py
index 20c15452b..919e22829 100644
--- a/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/thermal.py
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215-a1/sonic_platform/thermal.py
@@ -20,10 +20,10 @@ sonic_logger = logger.Logger('thermal')
 class Thermal(ThermalBase):
     """Nokia platform-specific Thermal class"""
 
-    I2C_CLASS_DIR = "/sys/class/i2c-adapter/"
-    I2C_DEV_MAPPING = (['i2c-0/0-0048/hwmon/', 1],
-                       ['i2c-0/0-0049/hwmon/', 1],
-                       ['i2c-0/0-004a/hwmon/', 1])
+    I2C_CLASS_DIR = "/sys/bus/i2c/devices/"
+    I2C_DEV_MAPPING = (['0-0048/hwmon/', 1],
+                       ['0-0049/hwmon/', 1],
+                       ['0-004a/hwmon/', 1])
 
     CN9130_THERMAL_DIR = "/sys/class/hwmon/hwmon1/"
     ASIC_TEMP_INFO = "ASIC_TEMPERATURE_INFO"
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215/scripts/nokia-7215init.sh b/platform/marvell-prestera/sonic-platform-nokia/7215/scripts/nokia-7215init.sh
index 5ec108d1c..0df213537 100755
--- a/platform/marvell-prestera/sonic-platform-nokia/7215/scripts/nokia-7215init.sh
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215/scripts/nokia-7215init.sh
@@ -42,21 +42,21 @@ ismux_bus=$(i2cdetect -l|grep mux|cut -f1)
 # Enumerate the SFP eeprom device on each mux channel
 for mux in ${ismux_bus}
 do
-    echo optoe2 0x50 > /sys/class/i2c-adapter/${mux}/new_device
+    echo optoe2 0x50 > /sys/bus/i2c/devices/${mux}/new_device
 done
 
 # Enumerate system eeprom
-echo 24c02 0x53 > /sys/class/i2c-adapter/i2c-0/new_device
+echo 24c02 0x53 > /sys/bus/i2c/devices/i2c-0/new_device
 sleep 2
-chmod 644 /sys/class/i2c-adapter/i2c-0/0-0053/eeprom
+chmod 644 /sys/bus/i2c/devices/i2c-0/0-0053/eeprom
 
 # Enumerate fan eeprom devices
-echo eeprom 0x55 > /sys/class/i2c-adapter/i2c-0/new_device
-echo eeprom 0x56 > /sys/class/i2c-adapter/i2c-0/new_device
+echo eeprom 0x55 > /sys/bus/i2c/devices/i2c-0/new_device
+echo eeprom 0x56 > /sys/bus/i2c/devices/i2c-0/new_device
 
 # Enumerate PSU eeprom devices
-echo eeprom 0x50 > /sys/class/i2c-adapter/i2c-1/new_device
-echo eeprom 0x51 > /sys/class/i2c-adapter/i2c-1/new_device
+echo eeprom 0x50 > /sys/bus/i2c/devices/i2c-1/new_device
+echo eeprom 0x51 > /sys/bus/i2c/devices/i2c-1/new_device
 
 # Enable optical SFP Tx
 i2cset -y -m 0x0f 0 0x41 0x5 0x00
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/chassis.py b/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/chassis.py
index 008d5ba08..f5e337e18 100755
--- a/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/chassis.py
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/chassis.py
@@ -72,8 +72,8 @@ class Chassis(ChassisBase):
 
         # Verify optoe2 driver SFP eeprom devices were enumerated and exist
         # then create the sfp nodes
-        eeprom_path = "/sys/class/i2c-adapter/i2c-{0}/{0}-0050/eeprom"
-        mux_dev = sorted(glob.glob("/sys/class/i2c-adapter/i2c-0/i2c-[0-9]"))
+        eeprom_path = "/sys/bus/i2c/devices/i2c-{0}/{0}-0050/eeprom"
+        mux_dev = sorted(glob.glob("/sys/bus/i2c/devices/i2c-0/i2c-[0-9]"))
         y = 0
         for index in range(self.SFP_PORT_START, self.SFP_PORT_END+1):
             mux_dev_num = mux_dev[y]
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/eeprom.py b/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/eeprom.py
index b3b31605b..42fc6a980 100644
--- a/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/eeprom.py
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/eeprom.py
@@ -34,7 +34,7 @@ sonic_logger = logger.Logger('eeprom')
 class Eeprom(TlvInfoDecoder):
     """Nokia platform-specific EEPROM class"""
 
-    I2C_DIR = "/sys/class/i2c-adapter/"
+    I2C_DIR = "/sys/bus/i2c/devices/"
 
     def __init__(self, is_psu=False, psu_index=0, is_fan=False, fan_index=0):
         self.is_psu_eeprom = is_psu
@@ -43,7 +43,7 @@ class Eeprom(TlvInfoDecoder):
 
         if self.is_sys_eeprom:
             self.start_offset = 0
-            self.eeprom_path = self.I2C_DIR + "i2c-0/0-0053/eeprom"
+            self.eeprom_path = self.I2C_DIR + "0-0053/eeprom"
 
             # System EEPROM is in ONIE TlvInfo EEPROM format
             super(Eeprom, self).__init__(self.eeprom_path,
@@ -54,7 +54,7 @@ class Eeprom(TlvInfoDecoder):
                 self.index = psu_index
                 self.start_offset = 18
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-1/1-005{}/eeprom".format(self.index - 1)
+                    + "1-005{}/eeprom".format(self.index - 1)
                 self.format = psu_eeprom_format
 
                 # Decode device eeprom as per specified format
@@ -64,7 +64,7 @@ class Eeprom(TlvInfoDecoder):
                 self.index = fan_index
                 self.start_offset = 0
                 self.eeprom_path = self.I2C_DIR \
-                    + "i2c-0/0-005{}/eeprom".format(self.index + 4)
+                    + "0-005{}/eeprom".format(self.index + 4)
 
                 # Fan EEPROM is in ONIE TlvInfo EEPROM format
                 super(Eeprom, self).__init__(self.eeprom_path,
diff --git a/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/thermal.py b/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/thermal.py
index 444ca5b13..2ed9ad70c 100644
--- a/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/thermal.py
+++ b/platform/marvell-prestera/sonic-platform-nokia/7215/sonic_platform/thermal.py
@@ -19,12 +19,12 @@ sonic_logger = logger.Logger('thermal')
 class Thermal(ThermalBase):
     """Nokia platform-specific Thermal class"""
 
-    I2C_CLASS_DIR = "/sys/class/i2c-adapter/"
-    I2C_DEV_MAPPING = (['i2c-0/0-004a/hwmon/', 1],
-                       ['i2c-0/0-004b/hwmon/', 1],
-                       ['i2c-0/0-002e/hwmon/', 1],
-                       ['i2c-0/0-002e/hwmon/', 2],
-                       ['i2c-0/0-002e/hwmon/', 3])
+    I2C_CLASS_DIR = "/sys/bus/i2c/devices/"
+    I2C_DEV_MAPPING = (['0-004a/hwmon/', 1],
+                       ['0-004b/hwmon/', 1],
+                       ['0-002e/hwmon/', 1],
+                       ['0-002e/hwmon/', 2],
+                       ['0-002e/hwmon/', 3])
 
     HWMON_CLASS_DIR = "/sys/class/hwmon/"
 
-- 
2.34.1

