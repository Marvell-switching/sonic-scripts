From f8c14ec5ce7acc54f27652bbddf2d4335c41643c Mon Sep 17 00:00:00 2001
From: Yan Markman <ymarkman@marvell.com>
Date: Sun, 12 Oct 2025 19:53:27 +0300
Subject: [PATCH 1/1] mrvlprestera rules for trixie

Signed-off-by: Yan Markman <ymarkman@marvell.com>
---
 debian/mrvlprestera.install.template |  3 +-
 debian/rules                         | 63 +++++++++++++---------------
 2 files changed, 31 insertions(+), 35 deletions(-)

diff --git a/debian/mrvlprestera.install.template b/debian/mrvlprestera.install.template
index 4d2c93d..5d3ea0d 100644
--- a/debian/mrvlprestera.install.template
+++ b/debian/mrvlprestera.install.template
@@ -1 +1,2 @@
-platform/ARCH/common/* /
+platform/ARCH/common/boot/*.dtb /boot
+platform/ARCH/common/usr/local/bin/* /usr/local/bin
diff --git a/debian/rules b/debian/rules
index 82bb817..a50fb85 100755
--- a/debian/rules
+++ b/debian/rules
@@ -1,46 +1,41 @@
 #!/usr/bin/make -f
 
+# Load dpkg helper macros (optional, can be used for PACKAGE_NAME etc.)
 include /usr/share/dpkg/pkg-info.mk
 
 PACKAGE_PRE_NAME := mrvlprestera
-MOD_SRC_DIR:= $(shell pwd)
+MOD_SRC_DIR := $(shell pwd)
 
 %:
-	dh $@ --with systemd,python3 --buildsystem=pybuild
+	dh $@
+	#dh $@ --with python3 --buildsystem=pybuild
 
-clean:
+# No build or configure needed for prebuilt files
+override_dh_auto_clean:
 	dh_testdir
 	dh_testroot
 	dh_clean
 
-build:
-	sed "s/ARCH/${CONFIGURED_ARCH}/g" ${MOD_SRC_DIR}/debian/mrvlprestera.install.template > ${MOD_SRC_DIR}/debian/mrvlprestera.install
-	# Done
-
-binary: binary-arch binary-indep
-	# Nothing to do
-
-binary-arch: 
-	# Nothing to do
-
-binary-indep:
-	dh_testdir
-	dh_installdirs
-
-	# Resuming debhelper scripts
-	dh_testroot
-	dh_install
-	dh_installchangelogs
-	dh_installdocs
-	dh_systemd_enable
-	dh_installinit
-	dh_systemd_start
-	dh_link
-	dh_fixperms
-	dh_compress
-	dh_strip
-	dh_installdeb
-	dh_gencontrol
-	dh_md5sums
-	dh_builddeb
-.PHONY: build binary binary-arch binary-indep clean
+override_dh_auto_configure:
+	# Nothing to configure
+
+override_dh_auto_build:
+	# Nothing to build; only generate .install file
+	@if [ "$(CONFIGURED_ARCH)" = "amd64" ]; then \
+		echo "platform/$(CONFIGURED_ARCH)/common/usr/local/bin/* /usr/local/bin" > \
+		    ${MOD_SRC_DIR}/debian/mrvlprestera.install; \
+	else \
+		sed "s/ARCH/${CONFIGURED_ARCH}/g" \
+		    ${MOD_SRC_DIR}/debian/mrvlprestera.install.template \
+		    > ${MOD_SRC_DIR}/debian/mrvlprestera.install; \
+	fi
+
+override_dh_auto_test:
+	# No tests to run
+
+override_dh_usrlocal:
+	# debian/sonic-platform-<>-<>/usr/local/bin/* are already done
+
+# Install files into package staging area according to generated .install
+override_dh_auto_install:
+	dh_auto_install
-- 
2.34.1

